**TCP三次握手（建立连接过程）**

| 角色发送 |  过程   |    报文首部     |      报文部分内容      |    状态     |
| -------- | :-----: | :-------------: | :--------------------: | :---------: |
| 客户端   | 1次握手 |     SYN = 1     |        seq = x         |  SYN_SENT   |
| 服务端   | 2次握手 | SYN = 1, ACK= 1 |  ack = x +1, seq = y   |  SYN_RECD   |
| 客户端   | 3次握手 |     ACK = 1     | ack = y + 1,seq = x +1 | ESTABLISHED |



**TCP四次挥手（断开连接过程）**

| 角色发送 |  过程   | 报文首部 |      报文部分内容       |    状态    |
| :------: | :-----: | :------: | :---------------------: | :--------: |
|  客户端  | 1次挥手 | FIN = 1  |         seq = u         | FIN_WAIT_1 |
|  服务端  | 2次挥手 | ACK = 1  |   ack = u +1,seq = v    | CLOSE_WAIT |
|  客户端  | 3次挥手 | FIN = 1  |   ack = u + 1,seq = w   |  LAST_ACK  |
|  服务端  | 4次挥手 | ACK = 1  | ack = w + 1，seq = u +1 | TIME_WAIT  |

> 注意此时的TCP连接还没有释放，必须经过2MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才会进入CLOSED状态。
>
> 服务器收到客户端发送的确认，立即进入CLOSED状态。
>
> 可以从上面发现，服务端结束连接要比客户端早一些

> PS： 
>
> seq：序列号  ack：确认号
>
> SYN：请求同步标志 ACK：确认标志  FIN ： 结束标志